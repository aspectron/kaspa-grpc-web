import { FlowGRPCWeb } from '@aspectron/flow-grpc-web';
export class RPC {
    constructor(options = {}) {
        this.isReady = false;
        this.queue = [];
        this.verbose = false;
        this.pending = {};
        this.client = new FlowGRPCWeb(options.grpc || {});
        this.client.on("ready", (clients) => {
            console.log("gRPCWeb::::clients", clients);
            let { RPC } = clients;
            const stream = RPC.MessageStream();
            this.stream = stream;
            console.log("stream", stream);
            stream.on("end", () => {
                console.log("stream end");
            });
            this.initIntake(stream);
            this.isReady = true;
            this.processQueue();
        });
    }
    initIntake(stream) {
        stream.on('data', (data) => {
            if (data.payload) {
                let name = data.payload;
                let payload = data[name];
                let ident = name.replace(/^get|Response$/ig, '').toLowerCase();
                this.handleIntake({ name, payload, ident });
            }
        });
    }
    handleIntake(o) {
        if (this.intakeHandler) {
            this.intakeHandler(o);
        }
        else {
            let handlers = this.pending[o.name];
            this.verbose && console.log('intake:', o, 'handlers:', handlers);
            if (handlers && handlers.length) {
                let pendingItem = handlers.shift();
                if (pendingItem)
                    pendingItem.resolve(o.payload);
            }
        }
    }
    setIntakeHandler(fn) {
        this.intakeHandler = fn;
    }
    processQueue() {
        if (!this.isReady)
            return;
        let item = this.queue.shift();
        while (item) {
            const resp = item.method.replace(/Request$/, 'Response');
            if (!this.pending[resp])
                this.pending[resp] = [];
            let handlers = this.pending[resp];
            handlers.push(item);
            let req = {};
            req[item.method] = item.data;
            this.stream.write(req);
            item = this.queue.shift();
        }
    }
    clearPending() {
        Object.keys(this.pending).forEach(key => {
            let list = this.pending[key];
            list.forEach(o => o.reject('closing by force'));
            this.pending[key] = [];
        });
    }
    request(method, data, resolve, reject) {
        this.queue.push({ method, data, resolve, reject });
        this.processQueue();
    }
    getBlock(hash) {
        return new Promise((resolve, reject) => {
            this.request('getBlockRequest', { hash, includeBlockVerboseData: true }, resolve, reject);
        });
    }
    getAddressTransactions(address, limit, skip) {
        return new Promise((resolve, reject) => {
            this.request('getAddressTransactions', { address, limit, skip }, resolve, reject);
        });
    }
    getUtxos(address, limit, skip) {
        return new Promise((resolve, reject) => {
            this.request('getUTXOsByAddressRequest', { address, limit, skip }, resolve, reject);
        });
    }
    postTx(transactionHex) {
        return new Promise((resolve, reject) => {
            this.request('submitTransactionRequest', { transactionHex }, resolve, reject);
        });
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicnBjLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vbGliL3JwYy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUMsV0FBVyxFQUFDLE1BQU0sMEJBQTBCLENBQUM7QUFtQnJELE1BQU0sT0FBTyxHQUFHO0lBU2YsWUFBWSxVQUFZLEVBQUU7UUFSMUIsWUFBTyxHQUFXLEtBQUssQ0FBQztRQUd4QixVQUFLLEdBQWUsRUFBRSxDQUFDO1FBR3ZCLFlBQU8sR0FBVyxLQUFLLENBQUM7UUFHdkIsSUFBSSxDQUFDLE9BQU8sR0FBRyxFQUFFLENBQUM7UUFDbEIsSUFBSSxDQUFDLE1BQU0sR0FBRyxJQUFJLFdBQVcsQ0FBQyxPQUFPLENBQUMsSUFBSSxJQUFFLEVBQUUsQ0FBQyxDQUFDO1FBRWhELElBQUksQ0FBQyxNQUFNLENBQUMsRUFBRSxDQUFDLE9BQU8sRUFBRSxDQUFDLE9BQVcsRUFBQyxFQUFFO1lBQ3RDLE9BQU8sQ0FBQyxHQUFHLENBQUMsb0JBQW9CLEVBQUUsT0FBTyxDQUFDLENBQUE7WUFDMUMsSUFBSSxFQUFDLEdBQUcsRUFBQyxHQUFHLE9BQU8sQ0FBQztZQUVwQixNQUFNLE1BQU0sR0FBRyxHQUFHLENBQUMsYUFBYSxFQUFFLENBQUM7WUFDbkMsSUFBSSxDQUFDLE1BQU0sR0FBRyxNQUFNLENBQUM7WUFDckIsT0FBTyxDQUFDLEdBQUcsQ0FBQyxRQUFRLEVBQUUsTUFBTSxDQUFDLENBQUE7WUFDN0IsTUFBTSxDQUFDLEVBQUUsQ0FBQyxLQUFLLEVBQUUsR0FBRSxFQUFFO2dCQUNwQixPQUFPLENBQUMsR0FBRyxDQUFDLFlBQVksQ0FBQyxDQUFBO1lBQzFCLENBQUMsQ0FBQyxDQUFDO1lBQ0gsSUFBSSxDQUFDLFVBQVUsQ0FBQyxNQUFNLENBQUMsQ0FBQztZQUN4QixJQUFJLENBQUMsT0FBTyxHQUFHLElBQUksQ0FBQztZQUNwQixJQUFJLENBQUMsWUFBWSxFQUFFLENBQUM7UUFDckIsQ0FBQyxDQUFDLENB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c0I7UUFDNUIsT0FBTyxJQUFJLE9BQU8sQ0FBQyxDQUFDLE9BQU8sRUFBRSxNQUFNLEVBQUMsRUFBRTtZQUNyQyxJQUFJLENBQUMsT0FBTyxDQUFDLDBCQUEwQixFQUFFLEVBQUMsY0FBYyxFQUFDLEVBQUUsT0FBTyxFQUFFLE1BQU0sQ0FBQyxDQUFDO1FBQzdFLENBQUMsQ0FBQyxDQUFBO0lBQ0gsQ0FBQztDQUNEIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtGbG93R1JQQ1dlYn0gZnJvbSAnQGFzcGVjdHJvbi9mbG93LWdycGMtd2ViJztcbi8vY29uc3QgRmxvd0dSUENXZWIgPSBuZXcgRmxvd0dSUENXZWIoKTtcbmltcG9ydCB7SVJQQywgQXBpfSBmcm9tICcuLi90eXBlcy9jdXN0b20tdHlwZXMnO1xuaW50ZXJmYWNlIFF1ZXVlSXRlbXtcblx0bWV0aG9kOnN0cmluZyxcblx0ZGF0YTphbnksXG5cdHJlc29sdmU6RnVuY3Rpb24sXG5cdHJlamVjdDpGdW5jdGlvblxufVxuaW50ZXJmYWNlIFBlbmRpbmdSZXFzIHtcblx0W2luZGV4OnN0cmluZ106UXVldWVJdGVtW107XG59XG5pbnRlcmZhY2UgSURhdGF7XG5cdG5hbWU6c3RyaW5nLFxuXHRwYXlsb2FkOmFueSxcblx0aWRlbnQ6c3RyaW5nXG59XG5kZWNsYXJlIHR5cGUgSVN0cmVhbSA9IGFueTtcblxuZXhwb3J0IGNsYXNzIFJQQyBpbXBsZW1lbnRzIElSUEN7XG5cdGlzUmVhZHk6Ym9vbGVhbiA9IGZhbHNlO1xuXHRjbGllbnQ6Rmxvd0dSUENXZWI7XG5cdHN0cmVhbTpJU3RyZWFtO1xuXHRxdWV1ZTpRdWV1ZUl0ZW1bXSA9IFtdO1xuXHRwZW5kaW5nOlBlbmRpbmdSZXFzO1xuXHRpbnRha2VIYW5kbGVyOkZ1bmN0aW9ufHVuZGVmaW5lZDtcblx0dmVyYm9zZTpib29sZWFuID0gZmFsc2U7XG5cblx0Y29uc3RydWN0b3Iob3B0aW9uczphbnk9e30pe1xuXHRcdHRoaXMucGVuZGluZyA9IHt9O1xuXHRcdHRoaXMuY2xpZW50ID0gbmV3IEZsb3dHUlBDV2ViKG9wdGlvbnMuZ3JwY3x8e30pO1xuXG5cdFx0dGhpcy5jbGllbnQub24oXCJyZWFkeVwiLCAoY2xpZW50czphbnkpPT57XG5cdFx0XHRjb25zb2xlLmxvZyhcImdSUENXZWI6Ojo6Y2xpZW50c1wiLCBjbGllbnRzKVxuXHRcdFx0bGV0IHtSUEN9ID0gY2xpZW50cztcblxuXHRcdFx0Y29uc3Qgc3RyZWFtID0gUlBDLk1lc3NhZ2VTdHJlYW0oKTtcblx0XHRcdHRoaXMuc3RyZWFtID0gc3RyZWFtO1xuXHRcdFx0Y29uc29sZS5sb2coXCJzdHJlYW1cIiwgc3RyZWFtKVxuXHRcdFx0c3RyZWFtLm9uKFwiZW5kXCIsICgpPT57XG5cdFx0XHRcdGNvbnNvbGUubG9nKFwic3RyZWFtIGVuZFwiKVxuXHRcdFx0fSk7XG5cdFx0XHR0aGlzLmluaXRJbnRha2Uoc3RyZWFtKTtcblx0XHRcdHRoaXMuaXNSZWFkeSA9IHRydWU7XG5cdFx0XHR0aGlzLnByb2Nlc3NRdWV1ZSgpO1xuXHRcdH0pXG5cdH1cblx0aW5pdEludGFrZShzdHJlYW06SVN0cmVhbSkge1xuICAgICAgICBzdHJlYW0ub24oJ2RhdGEnLChkYXRhOmFueSkgPT4ge1xuICAgICAgICAgICAgaWYoZGF0YS5wYXlsb2FkKSB7XG4gICAgICAgICAgICAgICAgbGV0IG5hbWUgPSBkYXRhLnBheWxvYWQ7XG4gICAgICAgICAgICAgICAgbGV0IHBheWxvYWQgPSBkYXRhW25hbWVdO1xuICAgICAgICAgICAgICAgIGxldCBpZGVudCA9IG5hbWUucmVwbGFjZSgvXmdldHxSZXNwb25zZSQvaWcsJycpLnRvTG93ZXJDYXNlKCk7XG4gICAgICAgICAgICAgICAgdGhpcy5oYW5kbGVJbnRha2Uoe25hbWUsIHBheWxvYWQsIGlkZW50fSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBoYW5kbGVJbnRha2UobzpJRGF0YSkge1xuICAgICAgICBpZih0aGlzLmludGFrZUhhbmRsZXIpIHtcbiAgICAgICAgICAgIHRoaXMuaW50YWtlSGFuZGxlcihvKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGxldCBoYW5kbGVycyA9IHRoaXMucGVuZGluZ1tvLm5hbWVdO1xuICAgICAgICAgICAgdGhpcy52ZXJib3NlICYmIGNvbnNvbGUubG9nKCdpbnRha2U6JyxvLCdoYW5kbGVyczonLGhhbmRsZXJzKTtcbiAgICAgICAgICAgIGlmKGhhbmRsZXJzICYmIGhhbmRsZXJzLmxlbmd0aCl7XG4gICAgICAgICAgICBcdGxldCBwZW5kaW5nSXRlbTpRdWV1ZUl0ZW18dW5kZWZpbmVkID0gaGFuZGxlcnMuc2hpZnQoKTtcbiAgICAgICAgICAgIFx0aWYocGVuZGluZ0l0ZW0pXG4gICAgICAgICAgICAgICAgXHRwZW5kaW5nSXRlbS5yZXNvbHZlKG8ucGF5bG9hZCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBzZXRJbnRha2VIYW5kbGVyKGZuOkZ1bmN0aW9uKSB7XG4gICAgICAgIHRoaXMuaW50YWtlSGFuZGxlciA9IGZuO1xuICAgIH1cblx0cHJvY2Vzc1F1ZXVlKCl7XG5cdFx0aWYoIXRoaXMuaXNSZWFkeSlcblx0XHRcdHJldHVyblxuXG5cdFx0bGV0IGl0ZW06UXVldWVJdGVtfHVuZGVmaW5lZCA9IHRoaXMucXVldWUuc2hpZnQoKTtcblx0XHR3aGlsZShpdGVtKXtcblx0XHRcdGNvbnN0IHJlc3AgPSBpdGVtLm1ldGhvZC5yZXBsYWNlKC9SZXF1ZXN0JC8sJ1Jlc3BvbnNlJyk7XG4gICAgICAgICAgICBpZighdGhpcy5wZW5kaW5nW3Jlc3BdKVxuICAgICAgICAgICAgICAgIHRoaXMucGVuZGluZ1tyZXNwXSA9IFtdO1xuICAgICAgICAgICAgbGV0IGhhbmRsZXJzOlF1ZXVlSXRlbVtdID0gdGhpcy5wZW5kaW5nW3Jlc3BdO1xuICAgICAgICAgICAgaGFuZGxlcnMucHVzaChpdGVtKTtcblxuXHRcdFx0bGV0IHJlcTphbnkgPSB7fTtcblx0XHRcdHJlcVtpdGVtLm1ldGhvZF0gPSBpdGVtLmRhdGE7XG5cdFx0XHR0aGlzLnN0cmVhbS53cml0ZShyZXEpO1xuXG5cdFx0XHRpdGVtID0gdGhpcy5xdWV1ZS5zaGlmdCgpO1xuXHRcdH1cblx0fVxuXHRjbGVhclBlbmRpbmcoKSB7XG4gICAgICAgIE9iamVjdC5rZXlzKHRoaXMucGVuZGluZykuZm9yRWFjaChrZXkgPT4ge1xuICAgICAgICAgICAgbGV0IGxpc3QgPSB0aGlzLnBlbmRpbmdba2V5XTtcbiAgICAgICAgICAgIGxpc3QuZm9yRWFjaChvPT5vLnJlamVjdCgnY2xvc2luZyBieSBmb3JjZScpKTtcbiAgICAgICAgICAgIHRoaXMucGVuZGluZ1trZXldID0gW107XG4gICAgICAgIH0pO1xuICAgIH1cblx0cmVxdWVzdChtZXRob2Q6c3RyaW5nLCBkYXRhOmFueSwgcmVzb2x2ZTpGdW5jdGlvbiwgcmVqZWN0OkZ1bmN0aW9uKXtcblx0XHR0aGlzLnF1ZXVlLnB1c2goe21ldGhvZCwgZGF0YSwgcmVzb2x2ZSwgcmVqZWN0fSk7XG5cdFx0dGhpcy5wcm9jZXNzUXVldWUoKTtcblx0fVxuXHRnZXRCbG9jayhoYXNoOnN0cmluZyk6IFByb21pc2U8QXBpLkJsb2NrUmVzcG9uc2U+e1xuXHRcdHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KT0+e1xuXHRcdFx0dGhpcy5yZXF1ZXN0KCdnZXRCbG9ja1JlcXVlc3QnLCB7aGFzaCwgaW5jbHVkZUJsb2NrVmVyYm9zZURhdGE6dHJ1ZX0sIHJlc29sdmUsIHJlamVjdCk7XG5cdFx0fSlcblx0fVxuXHRnZXRBZGRyZXNzVHJhbnNhY3Rpb25zKGFkZHJlc3M6c3RyaW5nLCBsaW1pdDpudW1iZXIsIHNraXA6bnVtYmVyKTogUHJvbWlzZTxBcGkuVHJhbnNhY3Rpb25bXT57XG5cdFx0cmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpPT57XG5cdFx0XHR0aGlzLnJlcXVlc3QoJ2dldEFkZHJlc3NUcmFuc2FjdGlvbnMnLCB7YWRkcmVzcywgbGltaXQsIHNraXB9LCByZXNvbHZlLCByZWplY3QpO1xuXHRcdH0pXG5cdH1cblx0Z2V0VXR4b3MoYWRkcmVzczpzdHJpbmcsIGxpbWl0Om51bWJlciwgc2tpcDpudW1iZXIpOiBQcm9taXNlPEFwaS5VdHhvW10+e1xuXHRcdHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KT0+e1xuXHRcdFx0dGhpcy5yZXF1ZXN0KCdnZXRVVFhPc0J5QWRkcmVzc1JlcXVlc3QnLCB7YWRkcmVzcywgbGltaXQsIHNraXB9LCByZXNvbHZlLCByZWplY3QpO1xuXHRcdH0pXG5cdH1cblx0cG9zdFR4KHRyYW5zYWN0aW9uSGV4OiBzdHJpbmcpOiBQcm9taXNlPEFwaS5TdWNjZXNzUmVzcG9uc2U+e1xuXHRcdHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KT0+e1xuXHRcdFx0dGhpcy5yZXF1ZXN0KCdzdWJtaXRUcmFuc2FjdGlvblJlcXVlc3QnLCB7dHJhbnNhY3Rpb25IZXh9LCByZXNvbHZlLCByZWplY3QpO1xuXHRcdH0pXG5cdH1cbn0iXX0=